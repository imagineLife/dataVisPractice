<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>StackedBar</title>
    <script src="../../../../d3.v4.min.js"></script>
    <script src="../../../../d3-selection-multi.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>    
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.js"></script> -->
    <!-- <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script> -->
    <!-- <link rel="stylesheet" type="text/css" href="../dark.css"> -->
  </head>
  <style type="text/css">
    body{
      margin:30px;
    }
  </style>
  <body>
    <div id="legend1" style="display: inline-block"></div>
  </body>
  <script>

    var colorScale1 = d3.scaleSequential(d3.interpolateGreens)
      .domain([0, 20]);

    continuous("#legend1", colorScale1);


    // create continuous color legend
    function continuous(selector_id, colorscale) {
      var legendheight = 200,
          legendwidth = 80,
          margin = {top: 10, right: 60, bottom: 10, left: 2};

      var canvas = d3.select(selector_id)
        .style("height", legendheight + "px")
        .style("width", legendwidth + "px")
        .style("position", "relative")
        .append("canvas")
        .attrs({
          "height": legendheight - margin.top - margin.bottom,
          "width": 1
        })
        .style("height", (legendheight - margin.top - margin.bottom) + "px")
        .style("width", (legendwidth - margin.left - margin.right) + "px")
        .style("border", "1px solid #000")
        .style("position", "absolute")
        .style("top", (margin.top) + "px")
        .style("left", (margin.left) + "px")
        .node();

      var canvasContext = canvas.getContext("2d");

      var legendscale = d3.scaleLinear()
        .range([1, legendheight - margin.top - margin.bottom])
        .domain(colorscale.domain());

      // image data hackery based on http://bl.ocks.org/mbostock/048d21cf747371b11884f75ad896e5a5
      var image = canvasContext.createImageData(1, legendheight);
      d3.range(legendheight).forEach(function(i) {
        var c = d3.rgb(colorscale(legendscale.invert(i)));
        image.data[4*i] = c.r;
        image.data[4*i + 1] = c.g;
        image.data[4*i + 2] = c.b;
        image.data[4*i + 3] = 255;
      });
      canvasContext.putImageData(image, 0, 0);


      var legendaxis = d3.axisRight()
        .scale(legendscale)
        .tickSize(6)
        .ticks(8);

      var svg = d3.select(selector_id)
        .append("svg")
        .attrs({
          "height": (legendheight) + "px",
          "width": (legendwidth) + "px"
        })
        .style("position", "absolute")
        .style("left", "0px")
        .style("top", "0px")

      svg
        .append("g")
        .attr("class", "axis")
        .attr("transform", "translate(" + (legendwidth - margin.left - margin.right + 3) + "," + (margin.top) + ")")
        .call(legendaxis);
    };

  </script>
  </body>

</html>